generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  name           String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  configurations Configuration[]
}

model Configuration {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  year      Int
  phases    String    // JSON: PhaseConfig[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Project[]

  @@unique([userId, year])
}

model Team {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  members   Member[]
  projects  Project[]
}

model Skill {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
}

model Role {
  id           String        @id @default(cuid())
  name         String        @unique
  createdAt    DateTime      @default(now())
  members      Member[]
  projectRoles ProjectRole[]
}

model Phase {
  id                   String @id @default(cuid())
  name                 String @unique
  defaultPercentBudget Int    @default(25)
  defaultMinWeeks      Int    @default(1)
  defaultMaxWeeks      Int    @default(4)
  sortOrder            Int    @default(0)
}

model Member {
  id           String        @id @default(cuid())
  name         String
  teamId       String?
  team         Team?         @relation(fields: [teamId], references: [id])
  roleId       String?
  role         Role?         @relation(fields: [roleId], references: [id])
  maxHours     Int           @default(40)
  skills       String        @default("{}") // JSON: Record<skillName, SkillLevel>
  color        String        @default("bg-slate-100 text-slate-800")
  isTemplate   Boolean       @default(false)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  assignments  Assignment[]
  projectRoles ProjectRole[]
}

model Project {
  id              String         @id @default(cuid())
  name            String
  teamId          String?
  team            Team?          @relation(fields: [teamId], references: [id])
  budgetHours     Int
  startWeek       Int            @default(0)
  locked          Boolean        @default(false)
  requiredSkills  String         @default("[]") // JSON: string[]
  phasesConfig    String?        // JSON: PhaseConfig[]
  overrides       String?        // JSON: ProjectOverrides
  configurationId String?
  configuration   Configuration? @relation(fields: [configurationId], references: [id])
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  assignments     Assignment[]
  projectRoles    ProjectRole[]
}

model Assignment {
  id        String   @id @default(cuid())
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  week      Int
  phaseId   String?
  hours     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([projectId, memberId, week])
}

model ProjectRole {
  id        String   @id @default(cuid())
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  roleId    String
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  memberId  String?
  member    Member?  @relation(fields: [memberId], references: [id], onDelete: SetNull)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
